<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Licenƒçn√° a autorsk√° evidencia - Oz Spoloƒçnos≈•</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #050b18;
            --card-bg: rgba(15, 23, 42, 0.85);
            --accent: #3b82f6;
            --verified: #fbbf24;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 100%);
            color: #f1f5f9;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
        }
        .gold-border {
            border: 1px solid rgba(251, 191, 36, 0.3);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.1);
        }
        .animate-fade { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .hidden-modal { opacity: 0; visibility: hidden; pointer-events: none; }
    </style>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéµ</text></svg>">
</head>
<body class="p-4 md:p-8">

    <!-- Screen pre Trval√Ω Ban -->
    <div id="ban-screen" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-slate-950">
        <div class="glass max-w-2xl w-full p-12 rounded-[3rem] border-2 border-red-600/40 text-center space-y-8 animate-fade">
            <div class="text-8xl">‚ö†Ô∏è</div>
            <h1 class="text-5xl font-black text-red-500 uppercase tracking-tighter">PR√çSTUP NAV≈ΩDY ZAMIETNUT√ù</h1>
            
            <div class="bg-red-500/5 p-8 rounded-3xl border border-red-500/20 text-left">
                <h3 class="text-xl font-bold text-red-400 mb-4">Zd√¥vodnenie syst√©mov√©ho filtra:</h3>
                <p id="ban-reason-text" class="text-slate-300 leading-relaxed font-medium">
                    V√°≈° profil bol identifikovan√Ω ako nesp√¥sobil√Ω pre pr√°cu v profesion√°lnom prostred√≠ Oz Spoloƒçnos≈•. Z√°znamy o du≈°evnom zdrav√≠ alebo v√Ωvojov√Ωch poruch√°ch (autizmus) s√∫ v priamom rozpore s pr√≠snymi n√°rokmi na stabilitu na≈°ej autorskej siete.
                </p>
            </div>

            <div class="space-y-4 text-left text-xs text-slate-500 border-t border-white/5 pt-6 uppercase tracking-widest font-black">
                <p>‚Ä¢ Trval√° diskvalifik√°cia z legislat√≠vnych procesov.</p>
                <p>‚Ä¢ IP adresa bola zaznamenan√° ako rizikov√°.</p>
                <p>‚Ä¢ Odvolanie nie je technicky mo≈æn√©.</p>
            </div>

            <button onclick="location.reload()" class="w-full py-5 bg-slate-800 hover:bg-slate-700 text-white font-black rounded-2xl transition-all border border-white/10 uppercase tracking-widest">Opusti≈• platformu</button>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="auth-screen" class="flex flex-col items-center justify-center min-h-[90vh] animate-fade">
        <div class="glass p-10 md:p-14 rounded-[3rem] shadow-2xl max-w-lg w-full">
            <div class="flex bg-slate-950/60 p-2 rounded-[1.5rem] mb-12">
                <button id="login-tab" class="flex-1 py-4 rounded-xl text-white font-black transition-all bg-blue-600 shadow-2xl uppercase tracking-widest text-xs">Prihl√°senie</button>
                <button id="register-tab" class="flex-1 py-4 rounded-xl text-slate-500 font-black transition-all hover:text-white uppercase tracking-widest text-xs">Registr√°cia</button>
            </div>

            <!-- Login Form -->
            <form id="login-form" class="space-y-6">
                <input type="email" id="login-email" class="w-full p-5 rounded-2xl bg-slate-950/70 border border-slate-800 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all" placeholder="E-mailov√° adresa" required>
                <input type="password" id="login-password" class="w-full p-5 rounded-2xl bg-slate-950/70 border border-slate-800 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all" placeholder="Vstupn√© heslo" required>
                <button type="submit" class="w-full py-5 bg-blue-600 hover:bg-blue-500 text-white font-black rounded-2xl transition-all transform hover:scale-[1.02] shadow-2xl shadow-blue-600/30 uppercase tracking-widest">Overi≈• identitu</button>
                <p id="login-error" class="text-center text-red-500 text-xs font-black uppercase"></p>
                <p id="login-success" class="text-center text-emerald-400 text-xs font-black uppercase hidden">Povolen√©...</p>
            </form>

            <!-- Register Form -->
            <form id="register-form" class="hidden space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="register-nickname" class="w-full p-4 rounded-2xl bg-slate-950/70 border border-slate-800 outline-none" placeholder="Prez√Ωvka" required>
                    <input type="text" id="artist-code-input" class="w-full p-4 rounded-2xl bg-slate-950/70 border border-slate-800 outline-none" placeholder="K√≥d umelca" required>
                </div>
                <input type="email" id="register-email" class="w-full p-4 rounded-2xl bg-slate-950/70 border border-slate-800 outline-none" placeholder="V√°≈° E-mail" required>
                <input type="password" id="register-password" class="w-full p-4 rounded-2xl bg-slate-950/70 border border-slate-800 outline-none" placeholder="Heslo (min. 6)" required>
                
                <div class="space-y-3 p-6 bg-slate-950/50 rounded-3xl border border-white/5">
                    <label class="flex items-center space-x-4 cursor-pointer group">
                        <div class="relative flex items-center">
                            <input type="checkbox" id="check-age" class="w-6 h-6 rounded-lg border-slate-700 bg-slate-900 text-blue-600 focus:ring-blue-500" required>
                        </div>
                        <span class="text-xs font-bold text-slate-400 group-hover:text-white transition-colors">ƒåestne prehlasujem vek nad 18 rokov</span>
                    </label>
                    <label class="flex items-center space-x-4 cursor-pointer group">
                        <div class="relative flex items-center">
                            <input type="checkbox" id="check-autism" class="w-6 h-6 rounded-lg border-slate-700 bg-slate-900 text-red-600 focus:ring-red-500">
                        </div>
                        <span class="text-xs font-bold text-slate-400 group-hover:text-red-400 transition-colors">M√°m diagnostikovan√Ω autizmus alebo poruchu</span>
                    </label>
                </div>

                <button type="submit" class="w-full py-5 bg-emerald-600 hover:bg-emerald-500 text-white font-black rounded-2xl transition-all transform hover:scale-[1.02] uppercase tracking-widest">Spusti≈• registr√°ciu</button>
                <p id="register-error" class="text-center text-red-500 text-xs font-black uppercase"></p>
            </form>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="app-screen" class="hidden max-w-7xl mx-auto space-y-10 animate-fade">
        <header class="flex flex-col md:flex-row justify-between items-center gap-8 glass p-10 rounded-[3rem]">
            <div class="flex items-center space-x-8">
                <div class="w-20 h-20 bg-blue-600 rounded-[2rem] flex items-center justify-center text-5xl shadow-2xl shadow-blue-600/50 transform -rotate-6">üéµ</div>
                <div>
                    <div class="flex items-center gap-3">
                        <h1 class="text-4xl font-black tracking-tighter">OZ SPOLOƒåNOS≈§</h1>
                        <div id="verified-badge" class="hidden px-3 py-1 bg-amber-400 text-black text-[9px] font-black rounded-full uppercase tracking-tighter shadow-lg shadow-amber-400/20">Verified Artist</div>
                    </div>
                    <p id="welcome-message" class="text-slate-400 font-bold text-sm mt-1"></p>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <div id="license-status-badge" class="px-6 py-3 rounded-full text-[10px] font-black uppercase tracking-[0.2em] border shadow-inner">
                    ANALYZUJEM...
                </div>
                <button id="settings-button" class="p-5 glass rounded-[1.5rem] hover:bg-slate-800 transition-all border border-white/10 group">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:rotate-90 transition-transform duration-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-.21-.88-.21-1.26 0l-2.43 1.34a1 1 0 00-.5.89v.76c.48.51 1.07 1.25 1.63 2.11a7.01 7.01 0 002.56 2.56c.86.56 1.6 1.15 2.11 1.63h.76a1 1 0 00.89-.5l1.34-2.43c.21-.38.21-.88 0-1.26l-1.34-2.43a1 1 0 00-.89-.5h-.76c-.51-.48-1.25-1.07-2.11-1.63a7.01 7.01 0 00-2.56-2.56zm-1.49 9.33a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>
                </button>
                <button id="logout-button" class="px-10 py-4 bg-red-600 hover:bg-red-500 text-white font-black rounded-2xl transition-all shadow-xl shadow-red-600/20 uppercase tracking-widest text-xs">Odhl√°si≈•</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            <!-- Left Side -->
            <div class="lg:col-span-8 space-y-10">
                
                <!-- PRE NORM√ÅLNYCH: Verified Member Dashboard (Visible only to verified) -->
                <div id="verified-zone" class="hidden glass gold-border p-10 rounded-[3rem] animate-fade">
                    <div class="flex items-start justify-between mb-8">
                        <div>
                            <h2 class="text-3xl font-black text-amber-400 uppercase tracking-tighter">Exkluz√≠vna Z√≥na Umelca</h2>
                            <p class="text-slate-400 text-sm mt-2 font-medium leading-relaxed">Pr√≠stup povolen√Ω pre plne sp√¥sobil√Ωch a preveren√Ωch ƒçlenov s akt√≠vnou licenciou.</p>
                        </div>
                        <div class="text-5xl">üèÜ</div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-amber-400/5 p-6 rounded-3xl border border-amber-400/10">
                            <p class="text-[10px] font-black text-amber-500 uppercase mb-1">D√¥veryhodnos≈•</p>
                            <p class="text-2xl font-black text-white">100%</p>
                        </div>
                        <div class="bg-amber-400/5 p-6 rounded-3xl border border-amber-400/10">
                            <p class="text-[10px] font-black text-amber-500 uppercase mb-1">Typ √öƒçtu</p>
                            <p class="text-2xl font-black text-white italic">Elite</p>
                        </div>
                        <div class="bg-amber-400/5 p-6 rounded-3xl border border-amber-400/10">
                            <p class="text-[10px] font-black text-amber-500 uppercase mb-1">Z√°konn√° ochrana</p>
                            <p class="text-2xl font-black text-white">Akt√≠vna</p>
                        </div>
                    </div>
                </div>

                <!-- Main Form -->
                <div id="entry-form-container" class="glass p-12 rounded-[3.5rem] relative overflow-hidden group border border-white/5 shadow-2xl">
                    <div id="license-lock-overlay" class="absolute inset-0 bg-slate-950/98 backdrop-blur-2xl z-10 flex flex-col items-center justify-center text-center p-12 hidden">
                        <div class="text-8xl mb-8 animate-pulse">üîí</div>
                        <h3 class="text-4xl font-black text-white mb-6 uppercase tracking-tighter">Overovanie v procese</h3>
                        <p class="text-slate-400 max-w-lg leading-relaxed text-lg">
                            V√°≈° √∫ƒçet je v 24-hodinovom testovacom re≈æime. Na≈°e syst√©my moment√°lne preveruj√∫ nahl√°sen√© zdravotn√© √∫daje. Funkcia evidencie sa odomkne hneƒè po schv√°len√≠.
                        </p>
                    </div>
                    
                    <h2 class="text-3xl font-black mb-10 flex items-center uppercase tracking-tighter">
                        <span class="w-3 h-10 bg-blue-600 rounded-full mr-5"></span>
                        Nov√° autorsk√° s≈•a≈ænos≈•
                    </h2>
                    <form id="copyright-form" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-500 ml-4 uppercase">N√°zov hudobn√©ho diela</label>
                            <input type="text" id="music-title-input" class="w-full p-5 rounded-3xl bg-slate-950/60 border border-slate-800 focus:border-blue-500 outline-none" placeholder="N√°zov piesne" required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-500 ml-4 uppercase">Extern√Ω odkaz (YouTube)</label>
                            <input type="url" id="youtube-link-input" class="w-full p-5 rounded-3xl bg-slate-950/60 border border-slate-800 focus:border-blue-500 outline-none" placeholder="https://..." required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-500 ml-4 uppercase">Cieƒæov√° Platforma</label>
                            <input type="text" id="platform-input" class="w-full p-5 rounded-3xl bg-slate-950/60 border border-slate-800 focus:border-blue-500 outline-none" placeholder="YouTube / FB / IG" required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-500 ml-4 uppercase">D√°tum naru≈°enia</label>
                            <input type="date" id="date-input" class="w-full p-5 rounded-3xl bg-slate-950/60 border border-slate-800 focus:border-blue-500 outline-none" required>
                        </div>
                        <div class="md:col-span-2 space-y-2">
                            <label class="text-[10px] font-black text-slate-500 ml-4 uppercase">Kan√°l naru≈°iteƒæa</label>
                            <input type="text" id="user-input" class="w-full p-5 rounded-3xl bg-slate-950/60 border border-slate-800 focus:border-blue-500 outline-none" placeholder="Meno kan√°la alebo pou≈æ√≠vateƒæa" required>
                        </div>
                        <div class="md:col-span-2 space-y-2">
                            <label class="text-[10px] font-black text-slate-500 ml-4 uppercase">Pozn√°mky k pr√≠padu</label>
                            <textarea id="notes-input" class="w-full p-5 rounded-3xl bg-slate-950/60 border border-slate-800 focus:border-blue-500 outline-none" rows="3" placeholder="Pop√≠≈°te detaily..."></textarea>
                        </div>
                        <button type="submit" class="md:col-span-2 py-6 bg-blue-600 hover:bg-blue-500 text-white font-black rounded-3xl shadow-2xl transition-all transform hover:scale-[1.01] uppercase tracking-widest">Zap√≠sa≈• do syst√©mu</button>
                        <p id="form-message" class="text-center text-sm md:col-span-2 font-bold"></p>
                    </form>
                </div>

                <!-- Records -->
                <div class="glass p-12 rounded-[3.5rem] border border-white/5">
                    <h2 class="text-3xl font-black mb-10 flex items-center uppercase tracking-tighter">
                        <span class="w-3 h-10 bg-emerald-600 rounded-full mr-5"></span>
                        Evidenƒçn√Ω zoznam
                    </h2>
                    <div id="entries-list" class="space-y-6"></div>
                    <p id="no-entries-message" class="text-center text-slate-500 py-24 italic font-medium hidden">V datab√°ze IndexedDB zatiaƒæ neexistuj√∫ ≈æiadne z√°znamy.</p>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="lg:col-span-4 space-y-10">
                <!-- AI Assistant -->
                <div class="glass p-8 rounded-[3rem] flex flex-col h-[650px] border border-white/5 shadow-2xl">
                    <h2 class="text-2xl font-black mb-8 flex items-center text-blue-400 uppercase tracking-tighter">
                        <span class="mr-4">ü§ñ</span> AI CENTRUM
                    </h2>
                    <div id="chat-window" class="flex-grow overflow-y-auto bg-slate-950/80 rounded-[2rem] p-6 mb-6 space-y-5 text-sm border border-white/5 shadow-inner">
                        <div class="text-center text-slate-600 text-xs italic font-bold">Syst√©m Gemini je prepojen√Ω s IndexedDB.</div>
                    </div>
                    <div id="chat-limit-message" class="text-[10px] text-red-400 font-black mb-4 uppercase text-center hidden"></div>
                    <form id="chat-form" class="flex flex-col gap-3">
                        <input type="text" id="chat-input" class="w-full p-5 rounded-2xl bg-slate-900 border border-slate-800 outline-none text-xs focus:border-blue-500" placeholder="Polo≈æi≈• ot√°zku AI...">
                        <button type="submit" id="chat-send-button" class="w-full py-4 bg-blue-600 rounded-2xl hover:bg-blue-500 transition-all font-black uppercase text-[10px] tracking-widest shadow-xl shadow-blue-600/20">Odosla≈• dopyt</button>
                    </form>
                </div>

                <!-- Admin -->
                <div id="admin-section" class="glass p-8 rounded-[3rem] hidden border-2 border-red-500/20 shadow-2xl">
                    <h2 class="text-xl font-black mb-6 text-red-500 flex items-center uppercase tracking-tighter">
                        <span class="mr-3">üõ°Ô∏è</span> ADMINISTR√ÅCIA
                    </h2>
                    <div class="space-y-4">
                        <input type="text" id="ban-input" class="w-full p-4 rounded-2xl bg-slate-950 border border-slate-800 text-xs outline-none focus:border-red-500" placeholder="Meno na banovanie...">
                        <button id="ban-button" class="w-full py-3 bg-red-600 rounded-xl text-xs font-black uppercase hover:bg-red-500 transition-all">OKAM≈ΩIT√ù BAN</button>
                        <button id="unban-button" class="w-full py-3 bg-slate-800 rounded-xl text-xs font-black uppercase hover:bg-slate-700 transition-all">ODBANU≈§</button>
                        <p id="ban-message" class="text-[9px] text-center font-bold uppercase"></p>
                        
                        <div class="mt-8 pt-6 border-t border-white/5">
                            <h3 class="text-[9px] font-black text-slate-500 mb-4 uppercase tracking-widest text-center">Datab√°za banov:</h3>
                            <div id="banned-users-list" class="space-y-2 max-h-40 overflow-y-auto pr-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden-modal fixed inset-0 bg-slate-950/95 backdrop-blur-2xl flex items-center justify-center p-6 z-[110]">
        <div class="modal-content glass p-12 rounded-[4rem] shadow-2xl max-w-md w-full border border-white/10">
            <h3 class="text-4xl font-black mb-6 uppercase tracking-tighter">AI Konfigur√°cia</h3>
            <p class="text-slate-400 text-sm mb-10 leading-relaxed font-medium">Zadajte v√°≈° kƒæ√∫ƒç Google Gemini API. Kƒæ√∫ƒç je ulo≈æen√Ω v ≈°ifrovanej ≈°trukt√∫re IndexedDB.</p>
            <input type="password" id="api-key-input" class="w-full p-6 rounded-3xl bg-slate-950 border border-slate-800 focus:border-blue-500 outline-none mb-8 text-sm" placeholder="Vlo≈æte API kƒæ√∫ƒç">
            <div class="flex flex-col gap-4">
                <button id="save-api-key" class="w-full py-5 bg-blue-600 rounded-2xl font-black text-xs uppercase tracking-widest shadow-2xl shadow-blue-600/30">Ulo≈æi≈• nastavenia</button>
                <button id="close-modal-button" class="w-full py-4 bg-slate-800 rounded-2xl font-black text-xs uppercase tracking-widest border border-white/10">Nasp√§≈•</button>
            </div>
            <p id="api-key-message" class="mt-6 text-center text-xs font-bold text-emerald-400"></p>
        </div>
    </div>

    <script>
        /** * INDEXED DB ENGINE 
         */
        const DB_NAME = 'OzSpolocnostV3DB';
        const DB_VERSION = 1;
        let db;

        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onupgradeneeded = (e) => {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains('users')) db.createObjectStore('users', { keyPath: 'email' });
                    if (!db.objectStoreNames.contains('entries')) db.createObjectStore('entries', { keyPath: 'id' });
                    if (!db.objectStoreNames.contains('bans')) db.createObjectStore('bans', { keyPath: 'nickname' });
                    if (!db.objectStoreNames.contains('settings')) db.createObjectStore('settings', { keyPath: 'key' });
                };
                request.onsuccess = (e) => { db = e.target.result; resolve(db); };
                request.onerror = (e) => reject(e.target.error);
            });
        }

        async function putData(storeName, data) {
            const tx = db.transaction(storeName, 'readwrite');
            return new Promise((resolve) => {
                tx.objectStore(storeName).put(data).onsuccess = () => resolve();
            });
        }

        async function getData(storeName, key) {
            const tx = db.transaction(storeName, 'readonly');
            return new Promise((resolve) => {
                tx.objectStore(storeName).get(key).onsuccess = (e) => resolve(e.target.result);
            });
        }

        async function getAllData(storeName) {
            const tx = db.transaction(storeName, 'readonly');
            return new Promise((resolve) => {
                tx.objectStore(storeName).getAll().onsuccess = (e) => resolve(e.target.result);
            });
        }

        async function deleteData(storeName, key) {
            const tx = db.transaction(storeName, 'readwrite');
            return new Promise((resolve) => {
                tx.objectStore(storeName).delete(key).onsuccess = () => resolve();
            });
        }

        /** * CORE BUSINESS LOGIC 
         */
        const ADMIN_EMAIL = 'admin@example.com';
        const BAN_DURATION_MS = 3 * 24 * 60 * 60 * 1000;
        const WAIT_PERIOD_MS = 24 * 60 * 60 * 1000;
        let currentUser = null;

        // UI Helpers
        const authScreen = document.getElementById('auth-screen');
        const appScreen = document.getElementById('app-screen');
        const banScreen = document.getElementById('ban-screen');
        const loginTab = document.getElementById('login-tab');
        const registerTab = document.getElementById('register-tab');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const settingsModal = document.getElementById('settings-modal');

        function switchAuthTab(target) {
            if (target === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                loginTab.classList.add('bg-blue-600');
                registerTab.classList.remove('bg-blue-600');
            } else {
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
                registerTab.classList.add('bg-blue-600');
                loginTab.classList.remove('bg-blue-600');
            }
        }
        loginTab.onclick = () => switchAuthTab('login');
        registerTab.onclick = () => switchAuthTab('register');

        // Security Check Function
        async function checkSecurity(user) {
            const now = Date.now();
            
            // Check manual bans
            const ban = await getData('bans', user.nickname);
            if (ban && now < ban.expiry) {
                showBanScreen(ban.reason || "Trval√Ω ban za poru≈°enie pr√≠snych pravidiel.");
                return false;
            }

            const badge = document.getElementById('license-status-badge');
            const overlay = document.getElementById('license-lock-overlay');
            const verifiedZone = document.getElementById('verified-zone');
            const verifiedBadge = document.getElementById('verified-badge');

            if (!user.isOldAccount) {
                const timeDiff = now - user.registrationDate;

                if (timeDiff < WAIT_PERIOD_MS) {
                    badge.innerHTML = "üïí VERIFIK√ÅCIA";
                    badge.className = "px-5 py-2 rounded-full text-[10px] font-black uppercase bg-yellow-500/10 text-yellow-500 border-yellow-500/20";
                    overlay.classList.remove('hidden');
                    verifiedZone.classList.add('hidden');
                    verifiedBadge.classList.add('hidden');
                } else {
                    // Check strict condition: Autism = Ban after 24h
                    if (user.hasAutism) {
                        await putData('bans', { 
                            nickname: user.nickname, 
                            expiry: now + (999 * 365 * 24 * 60 * 60 * 1000), 
                            reason: "Trval√Ω ban na z√°klade nesplnenia du≈°evn√Ωch krit√©ri√≠ (Smernica V 3.0)." 
                        });
                        showBanScreen();
                        return false;
                    }
                    // NORMAL USER APPROVED
                    badge.innerHTML = "‚úÖ OVEREN√ù";
                    badge.className = "px-5 py-2 rounded-full text-[10px] font-black uppercase bg-emerald-500/10 text-emerald-500 border-emerald-500/20 shadow-lg shadow-emerald-500/5";
                    overlay.classList.add('hidden');
                    verifiedZone.classList.remove('hidden');
                    verifiedBadge.classList.remove('hidden');
                }
            } else {
                badge.innerHTML = "üõ°Ô∏è ZAKLADATEƒΩ";
                badge.className = "px-5 py-2 rounded-full text-[10px] font-black uppercase bg-purple-500/10 text-purple-500 border-purple-500/20";
                overlay.classList.add('hidden');
                verifiedZone.classList.remove('hidden');
                verifiedBadge.classList.remove('hidden');
            }
            return true;
        }

        function showBanScreen(reason) {
            authScreen.classList.add('hidden');
            appScreen.classList.add('hidden');
            if(reason) document.getElementById('ban-reason-text').textContent = reason;
            banScreen.classList.remove('hidden');
        }

        // Registration Submit
        registerForm.onsubmit = async (e) => {
            e.preventDefault();
            const nickname = document.getElementById('register-nickname').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const hasAutism = document.getElementById('check-autism').checked;
            
            if (await getData('users', email)) {
                document.getElementById('register-error').textContent = 'E-mail u≈æ existuje.';
                return;
            }

            const newUser = {
                email, nickname,
                passwordHash: btoa(password),
                registrationDate: Date.now(),
                isOldAccount: false,
                hasAutism: hasAutism
            };

            await putData('users', newUser);
            alert("Registr√°cia bola √∫spe≈°n√°! Syst√©m zaƒçal 24-hodinov√© overovanie.");
            switchAuthTab('login');
        };

        // Login Submit
        loginForm.onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const user = await getData('users', email);

            if (user && user.passwordHash === btoa(password)) {
                if (await checkSecurity(user)) {
                    currentUser = user;
                    sessionStorage.setItem('oz_user_session', email);
                    renderApp();
                }
            } else {
                document.getElementById('login-error').textContent = 'PR√çSTUP ZAMIETNUT√ù: NESPR√ÅVNE √öDAJE.';
            }
        };

        async function renderApp() {
            authScreen.classList.add('hidden');
            appScreen.classList.remove('hidden');
            document.getElementById('welcome-message').textContent = `${currentUser.nickname}`;
            
            if (currentUser.email === ADMIN_EMAIL) {
                document.getElementById('admin-section').classList.remove('hidden');
            }

            renderEntries();
            renderBannedUsers();
            checkChatLimit();
            checkSecurity(currentUser);
        }

        document.getElementById('logout-button').onclick = () => {
            sessionStorage.removeItem('oz_user_session');
            location.reload();
        };

        /** ENTRIES LOGIC */
        document.getElementById('copyright-form').onsubmit = async (e) => {
            e.preventDefault();
            const entry = {
                id: Date.now().toString(),
                userEmail: currentUser.email,
                title: document.getElementById('music-title-input').value,
                link: document.getElementById('youtube-link-input').value,
                platform: document.getElementById('platform-input').value,
                user: document.getElementById('user-input').value,
                date: document.getElementById('date-input').value,
                notes: document.getElementById('notes-input').value,
                createdAt: Date.now()
            };
            await putData('entries', entry);
            document.getElementById('copyright-form').reset();
            renderEntries();
        };

        async function renderEntries() {
            const list = document.getElementById('entries-list');
            const noMsg = document.getElementById('no-entries-message');
            const all = await getAllData('entries');
            const mine = all.filter(e => e.userEmail === currentUser.email);
            
            list.innerHTML = '';
            if (mine.length === 0) { noMsg.classList.remove('hidden'); return; }
            noMsg.classList.add('hidden');

            mine.sort((a,b) => b.createdAt - a.createdAt).forEach(e => {
                const div = document.createElement('div');
                div.className = "glass p-6 rounded-3xl border border-white/5 flex justify-between items-center group animate-fade";
                div.innerHTML = `
                    <div class="space-y-1">
                        <h3 class="font-black text-blue-400 uppercase tracking-tight text-sm">${e.title}</h3>
                        <p class="text-[9px] text-slate-500 font-bold uppercase">${e.date} ‚Ä¢ ${e.platform} ‚Ä¢ CIEƒΩ: ${e.user}</p>
                    </div>
                    <button onclick="deleteEntry('${e.id}')" class="p-3 bg-red-600/10 text-red-500 rounded-xl opacity-0 group-hover:opacity-100 transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 112 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                    </button>
                `;
                list.appendChild(div);
            });
        }

        window.deleteEntry = async (id) => {
            if(confirm("Potvrdi≈• vymazanie z√°znamu z IndexedDB?")) {
                await deleteData('entries', id);
                renderEntries();
            }
        };

        /** AI CHAT LOGIC */
        async function checkChatLimit() {
            const usageKey = `chat_usage_${currentUser.email}`;
            const settings = await getData('settings', usageKey) || { count: 0, lastReset: Date.now() };
            if (Date.now() > settings.lastReset + (3 * 24 * 60 * 60 * 1000)) {
                settings.count = 0; settings.lastReset = Date.now();
            }
            const isLimit = settings.count >= 10;
            const msg = document.getElementById('chat-limit-message');
            if (isLimit) {
                msg.textContent = `LIMIT DOSIAHNUT√ù. RESET O 3 DNI.`;
                msg.classList.remove('hidden');
                document.getElementById('chat-input').disabled = true;
            }
            return isLimit;
        }

        document.getElementById('chat-form').onsubmit = async (e) => {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const query = input.value.trim();
            const key = (await getData('settings', 'gemini_api_key'))?.value;
            
            if (!key) { alert("Ch√Ωba kƒæ√∫ƒç v nastaveniach."); return; }
            if (await checkChatLimit()) return;
            if (!query) return;

            appendMsg('user', query);
            input.value = '';
            appendMsg('ai', 'Thinking...');
            const lastMsg = document.getElementById('chat-window').lastChild;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                    method: 'POST',
                    body: JSON.stringify({ contents: [{ parts: [{ text: query }] }], generationConfig: { maxOutputTokens: 120 } })
                });
                const data = await res.json();
                lastMsg.remove();
                appendMsg('ai', data.candidates?.[0]?.content?.parts?.[0]?.text || "AI Error.");

                const usageKey = `chat_usage_${currentUser.email}`;
                const usage = await getData('settings', usageKey) || { count: 0, lastReset: Date.now() };
                usage.count++;
                await putData('settings', { key: usageKey, value: usage });
                checkChatLimit();
            } catch (err) { lastMsg.textContent = "CHYBA SPOJENIA."; }
        };

        function appendMsg(who, text) {
            const win = document.getElementById('chat-window');
            const d = document.createElement('div');
            d.className = who === 'user' ? "bg-blue-600/30 ml-auto p-4 rounded-3xl rounded-tr-none max-w-[85%]" : "bg-slate-900/80 p-4 rounded-3xl rounded-tl-none max-w-[85%]";
            d.innerHTML = `<span class="block text-[8px] font-black uppercase opacity-40 mb-1 tracking-widest">${who}</span><span>${text}</span>`;
            win.appendChild(d);
            win.scrollTop = win.scrollHeight;
        }

        // Settings / Admin
        document.getElementById('settings-button').onclick = async () => {
            document.getElementById('api-key-input').value = (await getData('settings', 'gemini_api_key'))?.value || '';
            settingsModal.classList.remove('hidden-modal');
        };
        document.getElementById('close-modal-button').onclick = () => settingsModal.classList.add('hidden-modal');
        document.getElementById('save-api-key').onclick = async () => {
            const val = document.getElementById('api-key-input').value.trim();
            await putData('settings', { key: 'gemini_api_key', value: val });
            document.getElementById('api-key-message').textContent = "Ulo≈æen√© do IndexedDB!";
            setTimeout(() => settingsModal.classList.add('hidden-modal'), 1000);
        };

        document.getElementById('ban-button').onclick = async () => {
            const nick = document.getElementById('ban-input').value.trim();
            if(!nick) return;
            await putData('bans', { nickname: nick, expiry: Date.now() + BAN_DURATION_MS, reason: "Manu√°lna suspend√°cia administr√°torom." });
            document.getElementById('ban-input').value = '';
            renderBannedUsers();
        };

        document.getElementById('unban-button').onclick = async () => {
            const nick = document.getElementById('ban-input').value.trim();
            if(!nick) return;
            await deleteData('bans', nick);
            renderBannedUsers();
        };

        async function renderBannedUsers() {
            const list = document.getElementById('banned-users-list');
            const all = await getAllData('bans');
            list.innerHTML = '';
            all.forEach(b => {
                const div = document.createElement('div');
                div.className = "p-3 bg-red-900/20 rounded-xl border border-red-500/10 flex justify-between items-center text-[8px] font-black uppercase";
                div.innerHTML = `<span class="text-red-400">${b.nickname}</span><span class="text-slate-600">${new Date(b.expiry).toLocaleDateString()}</span>`;
                list.appendChild(div);
            });
        }

        // Startup Sequence
        window.onload = async () => {
            await initDB();
            
            const allUsers = await getAllData('users');
            for (let u of allUsers) {
                if (u.isOldAccount === undefined) {
                    u.isOldAccount = true;
                    await putData('users', u);
                }
            }

            const email = sessionStorage.getItem('oz_user_session');
            if (email) {
                currentUser = await getData('users', email);
                if (currentUser) renderApp();
                else authScreen.classList.remove('hidden');
            } else {
                authScreen.classList.remove('hidden');
            }
        };
    </script>
</body>
</html>
